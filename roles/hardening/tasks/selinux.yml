---
- name: Install selinux dependencies when selinux is installed
  become: true
  ansible.builtin.apt:
    name: "{{ ssh_selinux_packages }}"
    state: present

- name: Configure selinux | selinux-01
  become: true
  ansible.posix.selinux:
    policy: "{{ os_selinux_policy }}"
    state: "{{ os_selinux_state }}" # noqa args - see https://github.com/ansible/ansible-lint/issues/2930

- name: Authorize the following ports for selinux - {{ ssh_server_ports }}
  community.general.seport:
    ports: "{{ item }}"
    proto: tcp
    setype: ssh_port_t
    state: presentcd
  loop: "{{ ssh_server_ports }}"

- name: Check if ssh_password module is already installed
  ansible.builtin.shell: set -o pipefail && semodule -l | grep ssh_password
  args:
    executable: /bin/bash
  register: ssh_password_module
  failed_when: false
  changed_when: false
  check_mode: false
